<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Breed Classification</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl p-6 md:p-8 text-center">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Dog Breed Classifier üêï</h1>
        <p class="text-gray-600 mb-6">This tool uses a machine learning model to identify different dog-like animals in real-time.</p>

        <!-- Start Button -->
        <button id="start-button" type="button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300">
            Start Camera
        </button>

        <!-- Webcam and Label Containers -->
        <div id="webcam-container" class="mt-6 rounded-lg overflow-hidden w-full aspect-video bg-gray-200 flex items-center justify-center">
            <div id="loading-spinner" class="hidden animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600"></div>
        </div>
        <div id="label-container" class="mt-4 text-left space-y-3"></div>
    </div>
    
    <footer class="mt-8 text-center text-gray-500 text-sm">
        <p>Powered by Teachable Machine & TensorFlow.js</p>
        <p>To use, upload this file along with your model files (`model.json`, `weights.bin`, `metadata.json`) to a GitHub repository and enable GitHub Pages.</p>
    </footer>

    <!-- TensorFlow.js and Teachable Machine Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

    <script type="text/javascript">
        // --- Teachable Machine Model ---

        // The URL for your model, hosted in the same repository
        const URL = "./";

        let model, webcam, labelContainer, maxPredictions;
        const startButton = document.getElementById('start-button');
        const webcamContainer = document.getElementById('webcam-container');
        const loadingSpinner = document.getElementById('loading-spinner');

        // Event listener for the start button
        startButton.addEventListener('click', init);

        // Load the image model and setup the webcam
        async function init() {
            // Show loading spinner and disable button
            startButton.disabled = true;
            startButton.textContent = 'Loading Model...';
            loadingSpinner.classList.remove('hidden');

            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            try {
                // Load the model and metadata
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                // Setup webcam
                const flip = true; // whether to flip the webcam
                webcam = new tmImage.Webcam(400, 400, flip); // width, height, flip
                await webcam.setup(); // request access to the webcam
                await webcam.play();
                window.requestAnimationFrame(loop);

                // Append webcam canvas to the container
                webcamContainer.innerHTML = ''; // Clear the container
                webcamContainer.appendChild(webcam.canvas);
                
                // Create the label container elements
                labelContainer = document.getElementById("label-container");
                for (let i = 0; i < maxPredictions; i++) { 
                    const div = document.createElement("div");
                    div.className = "flex items-center justify-between";
                    const label = document.createElement("div");
                    label.className = "w-1/4 text-lg font-medium";
                    const progressBarContainer = document.createElement("div");
                    progressBarContainer.className = "w-3/4 bg-gray-200 rounded-full h-6";
                    const progressBar = document.createElement("div");
                    progressBar.className = "bg-blue-600 h-6 rounded-full text-xs font-medium text-blue-100 text-center p-1 leading-none";
                    progressBar.style.width = "0%";
                    
                    progressBarContainer.appendChild(progressBar);
                    div.appendChild(label);
                    div.appendChild(progressBarContainer);
                    labelContainer.appendChild(div);
                }
                
                // Hide the start button
                startButton.classList.add('hidden');

            } catch (error) {
                console.error("Error initializing model:", error);
                // Handle errors (e.g., model not found, webcam access denied)
                startButton.disabled = false;
                startButton.textContent = 'Retry';
                loadingSpinner.classList.add('hidden');
                webcamContainer.innerHTML = '<p class="text-red-500">Failed to load model or access camera. Make sure your model files are in the same folder and you allow camera access.</p>';
            }
        }

        // Main prediction loop
        async function loop() {
            webcam.update(); // update the webcam frame
            await predict();
            window.requestAnimationFrame(loop);
        }

        // Run the webcam image through the image model
        async function predict() {
            // predict can take in an image, video or canvas html element
            const prediction = await model.predict(webcam.canvas);
            for (let i = 0; i < maxPredictions; i++) {
                const classPrediction = prediction[i].className;
                const probability = (prediction[i].probability * 100).toFixed(2);
                const labelDiv = labelContainer.childNodes[i].childNodes[0];
                const progressBar = labelContainer.childNodes[i].childNodes[1].childNodes[0];
                
                labelDiv.innerHTML = classPrediction;
                progressBar.style.width = probability + "%";
                progressBar.innerHTML = probability + "%";
            }
        }
    </script>
</body>
</html>
